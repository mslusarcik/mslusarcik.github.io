jQuery.fn.tree=function(a){return this.each(function(){if(tree_component.inst&&tree_component.inst[jQuery(this).attr("id")]){tree_component.inst[jQuery(this).attr("id")].destroy()}if(a!==false){var b=new tree_component();b.init(this,a)}})};function tree_component(){if(typeof tree_component.inst=="undefined"){tree_component.cntr=0;tree_component.inst=new Array();tree_component.drop=new Array();tree_component.focusInst=function(){return tree_component.inst[tree_component.focused]};tree_component.mousedown=function(b){var c=tree_component.focusInst();if(!c){return}var a=jQuery(b.target);if(tree_component.drop.length&&a.is("."+tree_component.drop.join(", ."))){c.drag=jQuery("<li id='dragged' class='dragged foreign "+b.target.className+"'><a href='#'>"+a.text()+"</a></li>");c._drag=c.drag;c.isdown=true;c.foreign=a;a.blur();b.preventDefault();b.stopPropagation();return false}b.stopPropagation();return true};tree_component.mouseup=function(b){var c=tree_component.focusInst();if(!c){return}if(tree_component.to){clearTimeout(tree_component.to)}if(tree_component.sto){clearTimeout(tree_component.sto)}if(c.foreign===false&&c.drag&&c.drag.parentNode&&c.drag.parentNode==jQuery(c.container).children("ul:eq(0)").get(0)){jQuery(c.drag).remove();if(c.moveType){var a=tree_component.inst[jQuery(c.moveRef).parents(".tree:eq(0)").attr("id")];if(a){a.moved(c.container.find("li.dragged"),c.moveRef,c.moveType,false,(c.settings.rules.drag_copy=="on"||(c.settings.rules.drag_copy=="ctrl"&&b.ctrlKey)))}}c.moveType=false;c.moveRef=false}if(c.drag&&c.foreign!==false){jQuery(c.drag).remove();if(c.moveType){var a=tree_component.inst[jQuery(c.moveRef).parents(".tree:eq(0)").attr("id")];if(a){a.settings.callback.ondrop.call(null,c.foreign.get(0),c.get_node(c.moveRef).get(0),c.moveType,c)}}c.foreign=false;c.moveType=false;c.moveRef=false}jQuery("#marker").hide();c._drag=false;c.drag=false;c.isdown=false;c.appended=false;c.container.find("li.dragged").removeClass("dragged");b.preventDefault();b.stopPropagation();return false};tree_component.mousemove=function(d){var g=tree_component.focusInst();if(!g){return}if(g.locked){return g.error("LOCKED")}if(g.isdown){if(tree_component.to){clearTimeout(tree_component.to)}if(!g.appended){g.container.children("ul:eq(0)").append(g.drag);var c=jQuery(g.drag).offsetParent();if(c.is("html")){c=jQuery("body")}g.po=c.offset();g.appended=true}jQuery(g.drag).css({left:(d.pageX-g.po.left-(g.settings.ui.rtl?jQuery(g.drag).width():-5)),top:(d.pageY-g.po.top+(jQuery.browser.opera?g.container.scrollTop():0)+15)});if(d.target.tagName=="IMG"&&d.target.id=="marker"){return false}var b=jQuery(d.target).parents(".tree:eq(0)");if(b.size()==0){if(tree_component.sto){clearTimeout(tree_component.sto)}if(jQuery(g.drag).children("IMG").size()==0){jQuery(g.drag).append("<img style='position:absolute; "+(g.settings.ui.rtl?"right":"left")+":4px; top:0px; background:white; padding:2px;' src='"+g.settings.ui.theme_path+"default/remove.png' />")}g.moveType=false;g.moveRef=false;jQuery("#marker").hide();return false}tree_component.inst[b.attr("id")].off_height();if(g.foreign===false&&b.get(0)!=g.container.get(0)&&(!g.settings.rules.multitree||!tree_component.inst[b.attr("id")].settings.rules.multitree)){if(jQuery(g.drag).children("IMG").size()==0){jQuery(g.drag).append("<img style='position:absolute; "+(g.settings.ui.rtl?"right":"left")+":4px; top:0px; background:white; padding:2px;' src='"+g.settings.ui.theme_path+"default/remove.png' />")}g.moveType=false;g.moveRef=false;jQuery("#marker").hide();return false}if(tree_component.sto){clearTimeout(tree_component.sto)}tree_component.sto=setTimeout(function(){tree_component.inst[b.attr("id")].scrollCheck(d.pageX,d.pageY)},50);var f=false;var a=b.scrollTop();if(d.target.tagName=="A"){if(jQuery(d.target).is("#dragged")){return false}var e={x:(jQuery(d.target).offset().left-1),y:(d.pageY-tree_component.inst[b.attr("id")].offset.top)};if(b.hasClass("rtl")){e.x+=jQuery(d.target).width()-8}if((e.y+a)%g.li_height<g.li_height/3+1){f="before";e.y=d.pageY-(e.y+a)%g.li_height-2}else{if((e.y+a)%g.li_height>g.li_height*2/3-1){f="after";e.y=d.pageY-(e.y+a)%g.li_height+g.li_height-2}else{f="inside";e.x-=2;if(b.hasClass("rtl")){e.x+=36}e.y=d.pageY-(e.y+a)%g.li_height+Math.floor(g.li_height/2)-2;if(g.get_node(d.target).hasClass("closed")){tree_component.to=setTimeout(function(){g.open_branch(g.get_node(d.target))},500)}}}if(tree_component.inst[b.attr("id")].checkMove(g.container.find("li.dragged"),jQuery(d.target),f)){if(f=="inside"){jQuery("#marker").attr("src",g.settings.ui.theme_path+"default/plus.gif").width(11)}else{if(b.hasClass("rtl")){jQuery("#marker").attr("src",g.settings.ui.theme_path+"default/marker_rtl.gif").width(40)}else{jQuery("#marker").attr("src",g.settings.ui.theme_path+"default/marker.gif").width(40)}}g.moveType=f;g.moveRef=d.target;jQuery(g.drag).children("IMG").remove();jQuery("#marker").css({left:e.x,top:e.y}).show()}else{if(jQuery(g.drag).children("IMG").size()==0){jQuery(g.drag).append("<img style='position:absolute; "+(g.settings.ui.rtl?"right:0px;":"left:4px;")+" top:0px; background:white; padding:2px;' src='"+g.settings.ui.theme_path+"default/remove.png' />")}g.moveType=false;g.moveRef=false;jQuery("#marker").hide()}}else{if(jQuery(g.drag).children("IMG").size()==0){jQuery(g.drag).append("<img style='position:absolute; "+(g.settings.ui.rtl?"right:0px;":"left:4px;")+" top:0px; background:white; padding:2px;' src='"+g.settings.ui.theme_path+"default/remove.png' />")}g.moveType=false;g.moveRef=false;jQuery("#marker").hide()}d.preventDefault();d.stopPropagation();return false}return true}}return{cntr:tree_component.cntr++,settings:{data:{type:"predefined",method:"GET",async:false,async_data:function(a){return{id:jQuery(a).attr("id")||0}},url:false,json:false},selected:false,opened:[],languages:[],path:false,cookies:false,ui:{dots:true,rtl:false,animation:0,hover_mode:true,scroll_spd:4,theme_path:false,theme_name:"default",context:[{id:"create",label:"Create",icon:"create.png",visible:function(a,b){if(a.length!=1){return false}return b.check("creatable",a)},action:function(a,b){b.create(false,a)}},"separator",{id:"rename",label:"Rename",icon:"rename.png",visible:function(a,b){if(a.length!=1){return false}return b.check("renameable",a)},action:function(a,b){b.rename()}},{id:"delete",label:"Delete",icon:"remove.png",visible:function(a,b){return b.check("deletable",a)},action:function(a,b){a.each(function(){b.remove(this)})}}]},rules:{multiple:false,metadata:false,type_attr:"rel",multitree:false,createat:"bottom",use_inline:false,clickable:"all",renameable:"all",deletable:"all",creatable:"all",draggable:"none",dragrules:"all",drag_copy:false,droppable:[]},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange:function(a,b){return true},beforemove:function(a,c,d,b){return true},beforecreate:function(a,c,d,b){return true},beforerename:function(a,c,b){return true},beforedelete:function(a,b){return true},onchange:function(a,b){},onrename:function(a,c,b){},onmove:function(a,c,d,b){},oncopy:function(a,c,d,b){},oncreate:function(a,c,d,b){},ondelete:function(a,b){},onopen:function(a,b){},onclose:function(a,b){},error:function(b,a){},ondblclk:function(a,b){b.toggle_branch.call(b,a);b.select_branch.call(b,a)},onrgtclk:function(a,b,c){},onload:function(a){},onfocus:function(a){},ondrop:function(a,c,d,b){}}},init:function(d,c){var h=this;this.container=jQuery(d);if(this.container.size==0){alert("Invalid container node!");return}tree_component.inst[this.cntr]=this;if(!this.container.attr("id")){this.container.attr("id","jstree_"+this.cntr)}tree_component.inst[this.container.attr("id")]=tree_component.inst[this.cntr];tree_component.focused=this.cntr;if(c&&c.cookies){this.settings.cookies=jQuery.extend({},this.settings.cookies,c.cookies);delete c.cookies;if(!this.settings.cookies.opts){this.settings.cookies.opts={}}}if(c&&c.callback){this.settings.callback=jQuery.extend({},this.settings.callback,c.callback);delete c.callback}if(c&&c.data){this.settings.data=jQuery.extend({},this.settings.data,c.data);delete c.data}if(c&&c.ui){this.settings.ui=jQuery.extend({},this.settings.ui,c.ui);delete c.ui}if(c&&c.rules){this.settings.rules=jQuery.extend({},this.settings.rules,c.rules);delete c.rules}if(c&&c.lang){this.settings.lang=jQuery.extend({},this.settings.lang,c.lang);delete c.lang}this.settings=jQuery.extend({},this.settings,c);if(this.settings.path==false){this.path="";jQuery("script").each(function(){if(this.src.toString().match(/tree_component.*?js$/)){h.path=this.src.toString().replace(/tree_component.*?js$/,"")}})}else{this.path=this.settings.path}this.current_lang=this.settings.languages&&this.settings.languages.length?this.settings.languages[0]:false;if(this.settings.languages&&this.settings.languages.length){this.sn=get_sheet_num("tree_component.css");var a=false;var g=this.container.attr("id")?"#"+this.container.attr("id"):".tree";for(var b=0;b<this.settings.languages.length;b++){a=add_css(g+" ."+this.settings.languages[b],this.sn);if(a!==false){if(this.settings.languages[b]==this.current_lang){a.style.display="inline"}else{a.style.display="none"}}}}if(this.settings.rules.droppable.length){for(i in this.settings.rules.droppable){if(i!="indexOf"&&i!="lastIndexOf"){tree_component.drop.push(this.settings.rules.droppable[i]);tree_component.drop=jQuery.unique(tree_component.drop)}}}if(this.settings.ui.theme_path===false){this.settings.ui.theme_path=this.path+"themes/"}this.theme=this.settings.ui.theme_path+h.settings.ui.theme_name+"/";add_sheet(h.settings.ui.theme_path+"default/style.css");if(this.settings.ui.theme_name!="default"){add_sheet(h.theme+"style.css")}this.container.addClass("tree");if(this.settings.ui.rtl){this.container.addClass("rtl")}if(this.settings.rules.multiple){this.selected_arr=[]}this.offset=false;if(this.settings.ui.dots==false){this.container.addClass("no_dots")}this.context=false;if(this.settings.ui.context!=false){var f='<div class="context">';for(i in this.settings.ui.context){if(this.settings.ui.context[i]=="separator"){f+="<span class='separator'>&nbsp;</span>";continue}var e="";if(this.settings.ui.context[i].icon){e="background-image:url('"+(this.settings.ui.context[i].icon.indexOf("/")==-1?this.theme+this.settings.ui.context[i].icon:this.settings.ui.context[i].icon)+"');"}f+='<a rel="'+this.settings.ui.context[i].id+'" href="#" style="'+e+'">'+this.settings.ui.context[i].label+"</a>"}f+="</div>";this.context=jQuery(f);this.context.hide();this.context.append=false}this.hovered=false;this.locked=false;if(this.settings.rules.draggable!="none"&&this.settings.rules.dragrules!="none"){var h=this;jQuery("<img>").attr({id:"marker",src:h.settings.ui.theme_path+"default/marker.gif"}).css({height:"5px",width:"40px",display:"block",position:"absolute",left:"30px",top:"30px",zIndex:"1000"}).hide().appendTo("body")}this.refresh();this.attachEvents();this.focus()},off_height:function(){if(this.offset===false){this.container.css({position:"relative"});this.offset=this.container.offset();var a=0;a=parseInt(jQuery.curCSS(this.container.get(0),"paddingTop",true),10);if(a){this.offset.top+=a}a=parseInt(jQuery.curCSS(this.container.get(0),"borderTopWidth",true),10);if(a){this.offset.top+=a}this.container.css({position:""})}if(!this.li_height){var a=this.container.find("ul li:eq(0)");this.li_height=a.height();if(a.children("ul:eq(0)").size()){this.li_height-=a.children("ul:eq(0)").height()}if(!this.li_height){this.li_height=18}}},refresh:function(e){if(this.locked){return this.error("LOCKED")}var g=this;this.opened=Array();if(this.settings.cookies&&jQuery.cookie(this.settings.cookies.prefix+"_open")){var f=jQuery.cookie(this.settings.cookies.prefix+"_open");var d=f.split(",");jQuery.each(d,function(){g.opened.push("#"+this.replace(/^#/,""))});this.settings.opened=false}else{if(this.settings.opened!=false){jQuery.each(this.settings.opened,function(h,k){g.opened.push("#"+this.replace(/^#/,""))});this.settings.opened=false}else{this.container.find("li.open").each(function(h){g.opened.push("#"+this.id)})}}if(this.selected){this.settings.selected=Array();if(this.selected_arr){jQuery.each(this.selected_arr,function(){g.settings.selected.push("#"+this.attr("id"))})}else{this.settings.selected.push("#"+this.selected.attr("id"))}}else{if(this.settings.cookies&&jQuery.cookie(this.settings.cookies.prefix+"_selected")){this.settings.selected=Array();var f=jQuery.cookie(this.settings.cookies.prefix+"_selected");var d=f.split(",");jQuery.each(d,function(){g.settings.selected.push("#"+this.replace(/^#/,""))})}else{if(this.settings.selected!==false){var d=Array();if((typeof this.settings.selected).toLowerCase()=="object"){jQuery.each(this.settings.selected,function(){d.push("#"+this.replace(/^#/,""))})}else{d.push("#"+this.settings.selected.replace(/^#/,""))}this.settings.selected=d}}}if(e&&this.settings.data.async){this.opened=Array();e=this.get_node(e);e.find("li.open").each(function(h){g.opened.push("#"+this.id)});this.close_branch(e,true);e.children("ul:eq(0)").html("");return this.open_branch(e,true,function(){g.reselect.apply(g)})}var a="tree-default";if(this.settings.ui.theme_name!="default"){a+=" tree-"+g.settings.ui.theme_name}if(this.settings.data.type=="xml_flat"||this.settings.data.type=="xml_nested"){this.scrtop=this.container.get(0).scrollTop;var c=(this.settings.data.type=="xml_flat")?"flat.xsl":"nested.xsl";this.container.getTransform(this.path+c,this.settings.data.url,{params:{theme_name:a,theme_path:g.theme},meth:g.settings.data.method,callback:function(){g.reselect.apply(g)}});return}else{if(this.settings.data.type=="json"){if(this.settings.data.json){var f="";if(this.settings.data.json.length){for(var b=0;b<this.settings.data.json.length;b++){f+=this.parseJSON(this.settings.data.json[b])}}else{f=this.parseJSON(this.settings.data.json)}this.container.html("<ul class='"+a+"'>"+f+"</ul>");this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");this.container.find("li").not(".open").not(".closed").addClass("leaf");this.reselect()}else{var g=this;jQuery.ajax({type:this.settings.data.method,url:this.settings.data.url,data:this.settings.data.async_data(false),dataType:"json",success:function(k){var l="";if(k.length){for(var h=0;h<k.length;h++){l+=g.parseJSON(k[h])}}else{l=g.parseJSON(k)}g.container.html("<ul class='"+a+"'>"+l+"</ul>");g.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");g.container.find("li").not(".open").not(".closed").addClass("leaf");g.reselect.apply(g)}})}}else{this.container.children("ul:eq(0)").attr("class",a);this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");this.container.find("li").not(".open").not(".closed").addClass("leaf");this.reselect()}}},parseJSON:function(d){if(!d||!d.data){return""}var f="";f+="<li ";var b=false;if(d.attributes){for(c in d.attributes){if(c!="indexOf"&&c!="lastIndexOf"){if(c=="class"){f+=" class='"+d.attributes[c]+" ";if(d.state=="closed"||d.state=="open"){f+=" "+d.state+" "}f+="' ";b=true}else{f+=" "+c+"='"+d.attributes[c]+"' "}}}}if(!b&&(d.state=="closed"||d.state=="open")){f+=" class='"+d.state+"' "}f+=">";if(this.settings.languages.length){for(var c=0;c<this.settings.languages.length;c++){var a=[];a.href="#";a.style="";a["class"]=this.settings.languages[c];if(d.data[this.settings.languages[c]]&&(typeof d.data[this.settings.languages[c]].attributes).toLowerCase()!="undefined"){for(j in d.data[this.settings.languages[c]].attributes){if(j!="indexOf"&&j!="lastIndexOf"){if(j=="style"||j=="class"){a[j]+=" "+d.data[this.settings.languages[c]].attributes[j]}else{a[j]=d.data[this.settings.languages[c]].attributes[j]}}}}if(d.data[this.settings.languages[c]]&&d.data[this.settings.languages[c]].icon){var e=d.data[this.settings.languages[c]].icon.indexOf("/")==-1?this.theme+d.data[this.settings.languages[c]].icon:d.data[this.settings.languages[c]].icon;a.style+=" ; background-image:url('"+e+"'); "}f+="<a";for(j in a){f+=" "+j+'="'+a[j]+'" '}f+=">"+((typeof d.data[this.settings.languages[c]].title).toLowerCase()!="undefined"?d.data[this.settings.languages[c]].title:d.data[this.settings.languages[c]])+"</a>"}}else{var a=[];a.href="#";a.style="";a["class"]="";if((typeof d.data.attributes).toLowerCase()!="undefined"){for(c in d.data.attributes){if(c!="indexOf"&&c!="lastIndexOf"){if(c=="style"||c=="class"){a[c]+=" "+d.data.attributes[c]}else{a[c]=d.data.attributes[c]}}}}if(d.data.icon){var e=d.data.icon.indexOf("/")==-1?this.theme+d.data.icon:d.data.icon;a.style+=" ; background-image:url('"+e+"');"}f+="<a";for(c in a){if(c!="indexOf"&&c!="lastIndexOf"){f+=" "+c+'="'+a[c]+'" '}}f+=">"+((typeof d.data.title).toLowerCase()!="undefined"?d.data.title:d.data)+"</a>"}if(d.children&&d.children.length){f+="<ul>";for(var c=0;c<d.children.length;c++){f+=this.parseJSON(d.children[c])}f+="</ul>"}f+="</li>";return f},getJSON:function(c,e,g,f){var k=this;if(!c||jQuery(c).size()==0){c=this.container.children("ul").children("li")}else{c=jQuery(c)}if(c.size()>1){var b=[];c.each(function(){b.push(k.getJSON(this,e,g))});return b}if(!e){e=["id","rel","class"]}if(!g){g=[]}var h={attributes:{},data:false};for(i in e){if(i!="indexOf"&&i!="lastIndexOf"){h.attributes[e[i]]=c.attr(e[i])}}if(this.settings.languages.length){h.data={};for(i in this.settings.languages){if(i!="indexOf"&&i!="lastIndexOf"){var d=c.children("a."+this.settings.languages[i]);if(f||g.length||d.get(0).style.backgroundImage.toString().length){h.data[this.settings.languages[i]]={};h.data[this.settings.languages[i]].title=d.text();if(d.get(0).style.backgroundImage.length){h.data[this.settings.languages[i]].icon=d.get(0).style.backgroundImage.replace("url(","").replace(")","")}if(g.length){h.data[this.settings.languages[i]].attributes={};for(j in g){h.data[this.settings.languages[i]].attributes[g[j]]=d.attr(g[j])}}}else{h.data[this.settings.languages[i]]=d.text()}}}}else{var d=c.children("a");if(f||g.length||d.get(0).style.backgroundImage.toString().length){h.data={};h.data.title=d.text();if(d.get(0).style.backgroundImage.length){h.data.icon=d.get(0).style.backgroundImage.replace("url(","").replace(")","")}if(g.length){h.data.attributes={};for(j in g){if(j!="indexOf"&&j!="lastIndexOf"){h.data.attributes[g[j]]=d.attr(g[j])}}}}else{h.data=d.text()}}if(c.children("ul").size()>0){h.children=[];c.children("ul").children("li").each(function(){h.children.push(k.getJSON(this,e,g))})}return h},focus:function(){if(this.locked){return false}if(tree_component.focused!=this.cntr){tree_component.focused=this.cntr;this.settings.callback.onfocus.call(null,this)}},show_context:function(c,a,d){var b=this.context.show().offsetParent();if(b.is("html")){b=jQuery("body")}b=b.offset();this.context.css({left:(a-b.left-(this.settings.ui.rtl?jQuery(this.context).width():-5)),top:(d-b.top+(jQuery.browser.opera?this.container.scrollTop():0)+15)})},hide_context:function(){this.context.hide()},attachEvents:function(){var a=this;this.container.bind("mouseup",function(b){setTimeout(function(){a.focus.apply(a)},5)}).bind("click",function(b){b.stopPropagation();return true}).listen("click","li",function(b){a.toggle_branch.apply(a,[b.target]);b.stopPropagation()}).listen("click","a",function(b){if(a.locked){b.preventDefault();b.target.blur();return a.error("LOCKED")}a.select_branch.apply(a,[b.target,b.ctrlKey||a.settings.rules.multiple=="on"]);if(a.inp){a.inp.blur()}b.preventDefault();b.target.blur();return false}).listen("dblclick","a",function(b){if(a.locked){b.preventDefault();b.stopPropagation();b.target.blur();return a.error("LOCKED")}a.settings.callback.ondblclk.call(null,a.get_node(b.target).get(0),a);b.preventDefault();b.stopPropagation();b.target.blur()}).listen("contextmenu","a",function(c){if(a.locked){c.target.blur();return a.error("LOCKED")}var f=a.settings.callback.onrgtclk.call(null,a.get_node(c.target).get(0),a,c);if(a.context){if(a.context.append==false){a.container.find("ul:eq(0)").append(a.context);a.context.append=true;for(i in a.settings.ui.context){if(i!="indexOf"&&i!="lastIndexOf"){if(a.settings.ui.context[i]=="separator"){continue}(function(){var g=a.settings.ui.context[i].action;a.context.children("[rel="+a.settings.ui.context[i].id+"]").bind("click",function(h){if(!$(this).hasClass("disabled")){g.call(null,a.selected_arr||a.selected,a);a.hide_context()}h.stopPropagation();h.preventDefault();return false}).bind("mouseup",function(h){this.blur();if($(this).hasClass("disabled")){h.stopPropagation();h.preventDefault();return false}})})()}}}var e=a.get_node(c.target);if(a.inp){a.inp.blur()}if(e){if(!e.children("a:eq(0)").hasClass("clicked")){a.select_branch.apply(a,[c.target,c.ctrlKey||a.settings.rules.multiple=="on"]);c.target.blur()}a.context.children("a").removeClass("disabled").show();var b=false;for(i in a.settings.ui.context){if(i!="indexOf"&&i!="lastIndexOf"){if(a.settings.ui.context[i]=="separator"){continue}var d=a.settings.ui.context[i].visible.call(null,a.selected_arr||a.selected,a);if(d===false){a.context.children("[rel="+a.settings.ui.context[i].id+"]").addClass("disabled")}if(d===-1){a.context.children("[rel="+a.settings.ui.context[i].id+"]").hide()}else{b=true}}}if(b==true){a.show_context(e,c.pageX,c.pageY)}c.preventDefault();c.stopPropagation();return false}}return f}).listen("mouseover","a",function(b){if(a.locked){b.preventDefault();b.stopPropagation();return a.error("LOCKED")}if(a.settings.ui.hover_mode&&a.hovered!==false&&b.target.tagName=="A"){a.hovered.children("a").removeClass("hover");a.hovered=false}});if(this.settings.rules.draggable!="none"&&this.settings.rules.dragrules!="none"){this.container.listen("mousedown","a",function(c){a.focus.apply(a);if(a.locked){return a.error("LOCKED")}var d=a.get_node(c.target);if(a.settings.rules.multiple!=false&&a.selected_arr.length>1&&d.children("a:eq(0)").hasClass("clicked")){var b=0;for(i in a.selected_arr){if(i!="indexOf"&&i!="lastIndexOf"){if(a.check("draggable",a.selected_arr[i])){a.selected_arr[i].addClass("dragged");b++}}}if(b>0){if(a.check("draggable",d)){a._drag=d}else{a._drag=a.container.find("li.dragged:eq(0)")}a.isdown=true;a.drag=a._drag.get(0).cloneNode(true);a.drag.id="dragged";jQuery(a.drag).children("a").html("Multiple selection").end().children("ul").remove()}}else{if(a.check("draggable",d)){a._drag=d;a.drag=d.get(0).cloneNode(true);a.drag.id="dragged";a.isdown=true;a.foreign=false;d.addClass("dragged")}}d.blur();c.preventDefault();c.stopPropagation();return false});jQuery(document).bind("mousedown",tree_component.mousedown).bind("mouseup",tree_component.mouseup).bind("mousemove",tree_component.mousemove)}if(a.context){jQuery(document).bind("mouseup",function(){a.hide_context()})}},checkMove:function(k,b,g){if(this.locked){return this.error("LOCKED")}var f=this;if(b.parents("li.dragged").size()>0||b.is(".dragged")){return this.error("MOVE: NODE OVER SELF")}if(k.size()==1){var c=k.eq(0);if(c.hasClass("foreign")){if(this.settings.rules.droppable.length==0){return false}if(!c.is("."+this.settings.rules.droppable.join(", ."))){return false}var h=false;for(i in this.settings.rules.droppable){if(i!="indexOf"&&i!="lastIndexOf"){if(c.is("."+this.settings.rules.droppable[i])){if(this.settings.rules.metadata){jQuery.metadata.setType("attr",this.settings.rules.metadata);c.attr(this.settings.rules.metadata,"type: '"+this.settings.rules.droppable[i]+"'")}else{c.attr(this.settings.rules.type_attr,this.settings.rules.droppable[i])}h=true;break}}}if(!h){return false}}if(!this.check("dragrules",[c,g,b.parents("li:eq(0)")])){return this.error("MOVE: AGAINST DRAG RULES")}}else{var h=true;k.each(function(m){if(h==false){return false}if(m>0){var n=k.eq((m-1));var l="after"}else{var n=b;var l=g}if(!f.check.apply(f,["dragrules",[jQuery(this),l,n]])){h=false}});if(h==false){return this.error("MOVE: AGAINST DRAG RULES")}}if(this.settings.rules.use_inline&&this.settings.rules.metadata){var d=false;if(g=="inside"){d=b.parents("li:eq(0)")}else{d=b.parents("li:eq(1)")}if(d.size()){if(typeof d.metadata()["valid_children"]!="undefined"){var e=d.metadata()["valid_children"];var h=true;k.each(function(l){if(h==false){return false}if(jQuery.inArray(f.get_type(this),e)==-1){h=false}});if(h==false){return this.error("MOVE: NOT A VALID CHILD")}}if(typeof d.metadata()["max_children"]!="undefined"){if((d.children("ul:eq(0)").children("li").not(".dragged").size()+k.size())>d.metadata().max_children){return this.error("MOVE: MAX CHILDREN REACHED")}}var a=0;k.each(function(m){var m=1;var l=jQuery(this);while(m<100){l=l.children("ul:eq(0)");if(l.size()==0){break}m++}a=Math.max(m,a)});var h=true;d.parents("li").each(function(l){if(h==false){return false}if(jQuery(this).metadata().max_depth){if((l+a)>=jQuery(this).metadata().max_depth){h=false}}});if(h==false){return this.error("MOVE: MAX_DEPTH REACHED")}}}return true},reselect:function(){var d=this;if(this.opened&&this.opened.length){var c=false;for(var a=0;a<this.opened.length;a++){if(this.settings.data.async){if(this.get_node(this.opened[a]).size()>0){c=true;var b=this.opened[a];delete this.opened[a];this.open_branch(b,true,function(){d.reselect.apply(d)})}}else{this.open_branch(this.opened[a],true)}}if(this.settings.data.async&&c){return}delete this.opened}if(this.scrtop){this.container.scrollTop(d.scrtop);delete this.scrtop}if(this.settings.selected!==false){jQuery.each(this.settings.selected,function(e){d.select_branch(jQuery(d.settings.selected[e]),(d.settings.rules.multiple!==false&&e>0))});this.settings.selected=false}this.settings.callback.onload.call(null,d)},get_node:function(a){var a=jQuery(a);return a.is("li")?a:a.parents("li:eq(0)")},get_type:function(b){b=!b?this.selected:this.get_node(b);if(!b){return}if(this.settings.rules.metadata){jQuery.metadata.setType("attr",this.settings.rules.metadata);var a=b.metadata().type;if(a){return a}}return b.attr(this.settings.rules.type_attr)},scrollCheck:function(b,h){var g=this;var d=g.container;var f=g.offset;var c=d.scrollTop();var a=d.scrollLeft();var e=(d.get(0).scrollWidth>d.width())?40:20;if(h-f.top<20){d.scrollTop(Math.max((c-g.settings.ui.scroll_spd),0))}if(d.height()-(h-f.top)<e){d.scrollTop(c+g.settings.ui.scroll_spd)}if(b-f.left<20){d.scrollLeft(Math.max((a-g.settings.ui.scroll_spd),0))}if(d.width()-(b-f.left)<40){d.scrollLeft(a+g.settings.ui.scroll_spd)}if(d.scrollLeft()!=a||d.scrollTop()!=c){g.moveType=false;g.moveRef=false;jQuery("#marker").hide()}tree_component.sto=setTimeout(function(){g.scrollCheck(b,h)},50)},check:function(g,a){if(this.locked){return this.error("LOCKED")}if(g!="dragrules"&&this.settings.rules.use_inline&&this.settings.rules.metadata){jQuery.metadata.setType("attr",this.settings.rules.metadata);if(typeof this.get_node(a).metadata()[g]!="undefined"){return this.get_node(a).metadata()[g]}}if(!this.settings.rules[g]){return false}if(this.settings.rules[g]=="none"){return false}if(this.settings.rules[g]=="all"){return true}if(g=="dragrules"){var f=new Array();f[0]=this.get_type(a[0]);f[1]=a[1];f[2]=this.get_type(a[2]);for(var d=0;d<this.settings.rules.dragrules.length;d++){var e=this.settings.rules.dragrules[d];var h=(e.indexOf("!")===0)?false:true;if(!h){e=e.replace("!","")}var c=e.split(" ");for(var b=0;b<3;b++){if(c[b]==f[b]||c[b]=="*"){c[b]=true}}if(c[0]===true&&c[1]===true&&c[2]===true){return h}}return false}else{return(jQuery.inArray(this.get_type(a),this.settings.rules[g])!=-1)?true:false}},hover_branch:function(e){if(this.locked){return this.error("LOCKED")}if(this.settings.ui.hover_mode==false){return this.select_branch(e)}var f=this;var e=f.get_node(e);if(!e.size()){return this.error("HOVER: NOT A VALID NODE")}if(!f.check("clickable",e)){return this.error("SELECT: NODE NOT SELECTABLE")}if(this.hovered){this.hovered.children("A").removeClass("hover")}this.hovered=e;this.hovered.children("a").removeClass("hover").addClass("hover");var b=this.hovered.offset().top;var a=this.container.offset().top;var c=a+this.container.height();var d=(this.container.get(0).scrollWidth>this.container.width())?40:20;if(b+5<a){this.container.scrollTop(this.container.scrollTop()-(a-b+5))}if(b+d>c){this.container.scrollTop(this.container.scrollTop()+(b+d-c))}},select_branch:function(f,a){if(this.locked){return this.error("LOCKED")}if(!f&&this.hovered!==false){f=this.hovered}var g=this;f=g.get_node(f);if(!f.size()){return this.error("SELECT: NOT A VALID NODE")}f.children("a").removeClass("hover");if(!g.check("clickable",f)){return this.error("SELECT: NODE NOT SELECTABLE")}if(g.settings.callback.beforechange.call(null,f.get(0),g)===false){return this.error("SELECT: STOPPED BY USER")}if(this.settings.rules.multiple!=false&&a&&f.children("a.clicked").size()>0){return this.deselect_branch(f)}if(this.settings.rules.multiple!=false&&a){this.selected_arr.push(f)}if(this.settings.rules.multiple!=false&&!a){for(i in this.selected_arr){if(i!="indexOf"&&i!="lastIndexOf"){this.selected_arr[i].children("A").removeClass("clicked")}}this.selected_arr=[];this.selected_arr.push(f);if(this.selected){this.selected.children("A").removeClass("clicked")}}if(!this.settings.rules.multiple){if(this.selected){this.selected.children("A").removeClass("clicked")}}this.selected=f;if(this.settings.ui.hover_mode&&this.hovered!==false){this.hovered.children("A").removeClass("hover");this.hovered=f}this.selected.children("a").removeClass("clicked").addClass("clicked").end().parents("li.closed").each(function(){g.open_branch(this,true)});var c=this.selected.offset().top;var b=this.container.offset().top;var d=b+this.container.height();var e=(this.container.get(0).scrollWidth>this.container.width())?40:20;if(c+5<b){this.container.scrollTop(this.container.scrollTop()-(b-c+5))}if(c+e>d){this.container.scrollTop(this.container.scrollTop()+(c+e-d))}this.set_cookie("selected");this.settings.callback.onchange.call(null,this.selected.get(0),g)},deselect_branch:function(a){if(this.locked){return this.error("LOCKED")}var b=this;var a=this.get_node(a);a.children("a").removeClass("clicked");if(this.settings.rules.multiple!=false&&this.selected_arr.length>1){this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){b.selected_arr.push(jQuery(this))});if(a.get(0)==this.selected.get(0)){this.selected=this.selected_arr[0];this.set_cookie("selected")}}else{if(this.settings.rules.multiple!=false){this.selected_arr=[]}this.selected=false;this.set_cookie("selected")}if(this.selected){this.settings.callback.onchange.call(null,this.selected.get(0),b)}else{this.settings.callback.onchange.call(null,false,b)}},toggle_branch:function(a){if(this.locked){return this.error("LOCKED")}var a=this.get_node(a);if(a.hasClass("closed")){return this.open_branch(a)}if(a.hasClass("open")){return this.close_branch(a)}},open_branch:function(c,a,f){if(this.locked){return this.error("LOCKED")}var c=this.get_node(c);if(!c.size()){return this.error("OPEN: NO SUCH NODE")}if(c.hasClass("leaf")){return this.error("OPEN: OPENING LEAF NODE")}if(this.settings.data.async&&c.find("li").size()==0){var e=this;c.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a class='loading' href='#'>"+(e.settings.lang.loading||"Loading ...")+"</a></li></ul>");c.removeClass("closed").addClass("open");if(this.settings.data.type=="xml_flat"||this.settings.data.type=="xml_nested"){var b=(this.settings.data.type=="xml_flat")?"flat.xsl":"nested.xsl";var d=(this.settings.data.url.indexOf("?")==-1)?"?id="+encodeURIComponent(c.attr("id")):"&id="+encodeURIComponent(c.attr("id"));c.children("ul:eq(0)").getTransform(this.path+b,this.settings.data.url+d,{params:{theme_path:e.theme},meth:this.settings.data.method,repl:true,callback:function(h,g){if(h.length<15){c.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();if(f){f.call()}return}e.open_branch.apply(e,[c]);if(f){f.call()}}})}else{jQuery.ajax({type:this.settings.data.method,url:this.settings.data.url,data:this.settings.data.async_data(c),dataType:"json",success:function(h,l){if(!h||h.length==0){c.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();if(f){f.call()}return}var k="";if(h.length){for(var g=0;g<h.length;g++){k+=e.parseJSON(h[g])}}else{k=e.parseJSON(h)}if(k.length>0){c.children("ul:eq(0)").replaceWith("<ul>"+k+"</ul>");c.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");c.find("li").not(".open").not(".closed").addClass("leaf");e.open_branch.apply(e,[c])}else{c.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove()}if(f){f.call()}}})}return true}else{if(parseInt(this.settings.ui.animation)>0&&!a&&!(jQuery.browser.msie&&jQuery.browser.version<7)){c.children("ul:eq(0)").css("display","none");c.removeClass("closed").addClass("open");c.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){jQuery(this).css("display","");if(f){f.call()}})}else{c.removeClass("closed").addClass("open");if(f){f.call()}}this.set_cookie("open");this.settings.callback.onopen.call(null,c.get(0),this);return true}},close_branch:function(b,a){if(this.locked){return this.error("LOCKED")}var c=this;var b=this.get_node(b);if(parseInt(this.settings.ui.animation)>0&&!a&&!(jQuery.browser.msie&&jQuery.browser.version<7)&&b.children("ul:eq(0)").size()==1){b.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){b.removeClass("open").addClass("closed");c.set_cookie("open");jQuery(this).css("display","")})}else{b.removeClass("open").addClass("closed");this.set_cookie("open")}if(this.selected&&b.children("ul:eq(0)").find("a.clicked").size()>0){b.find("li:has(a.clicked)").each(function(){c.deselect_branch(this)});if(b.children("a.clicked").size()==0){this.select_branch(b,(this.settings.rules.multiple!=false&&this.selected_arr.length>0))}}this.settings.callback.onclose.call(null,b.get(0),this)},open_all:function(a){if(this.locked){return this.error("LOCKED")}var b=this;a=a?jQuery(a):this.container;a.find("li.closed").each(function(){var c=this;b.open_branch.apply(b,[this,true,function(){b.open_all.apply(b,[c])}])})},close_all:function(){if(this.locked){return this.error("LOCKED")}var a=this;jQuery(this.container).find("li.open").each(function(){a.close_branch(this,true)})},show_lang:function(b){if(this.locked){return this.error("LOCKED")}if(this.settings.languages[b]==this.current_lang){return true}var a=false;var c=this.container.attr("id")?"#"+this.container.attr("id"):".tree";a=get_css(c+" ."+this.current_lang,this.sn);if(a!==false){a.style.display="none"}a=get_css(c+" ."+this.settings.languages[b],this.sn);if(a!==false){a.style.display="block"}this.current_lang=this.settings.languages[b];return true},cycle_lang:function(){if(this.locked){return this.error("LOCKED")}var a=jQuery.inArray(this.current_lang,this.settings.languages);a++;if(a>this.settings.languages.length-1){a=0}this.show_lang(a)},create:function(f,b,c,g,a){if(this.locked){return this.error("LOCKED")}b=b?this.get_node(b):this.selected;if(!b||!b.size()){return this.error("CREATE: NO NODE SELECTED")}if(!this.check("creatable",b)){return this.error("CREATE: CANNOT CREATE IN NODE")}var k=f||this.get_type(b)||"";if(this.settings.rules.use_inline&&this.settings.rules.metadata){jQuery.metadata.setType("attr",this.settings.rules.metadata);if(typeof b.metadata()["valid_children"]!="undefined"){if(jQuery.inArray(k,b.metadata()["valid_children"])==-1){return this.error("CREATE: NODE NOT A VALID CHILD")}}if(typeof b.metadata()["max_children"]!="undefined"){if((b.children("ul:eq(0)").children("li").size()+1)>b.metadata().max_children){return this.error("CREATE: MAX_CHILDREN REACHED")}}var h=true;b.parents("li").each(function(l){if(jQuery(this).metadata().max_depth){if((l+1)>=jQuery(this).metadata().max_depth){h=false}}});if(!h){return this.error("CREATE: MAX_DEPTH REACHED")}}if(b.hasClass("closed")){var d=this;return this.open_branch(b,true,function(){d.create.apply(d,[f,b,c,g,a])})}if(a){$li=jQuery("<li id='"+a+"' />")}else{$li=jQuery("<li />")}if(this.settings.rules.metadata){jQuery.metadata.setType("attr",this.settings.rules.metadata);$li.attr(this.settings.rules.metadata,"type: '"+k+"'")}else{$li.attr(this.settings.rules.type_attr,k)}var e="";if((typeof g).toLowerCase()=="string"){e=g;e=e.indexOf("/")==-1?this.theme+e:e}if(this.settings.languages.length){for(i=0;i<this.settings.languages.length;i++){if((typeof c).toLowerCase()=="string"){val=c}else{if(c&&c[i]){val=c[i]}else{if(this.settings.lang.new_node){if((typeof this.settings.lang.new_node).toLowerCase()!="string"&&this.settings.lang.new_node[i]){val=this.settings.lang.new_node[i]}else{val=this.settings.lang.new_node}}else{val="New folder"}}}if((typeof g).toLowerCase()!="string"&&g&&g[i]){e=g[i];e=e.indexOf("/")==-1?this.theme+e:e}$li.append("<a href='#'"+(e.length?" style='background-image:url(\""+e+"\");' ":" ")+"class='"+this.settings.languages[i]+"'>"+val+"</a>")}}else{$li.append("<a href='#'"+(e.length?" style='background-image:url(\""+e+"\");' ":" ")+">"+(c||this.settings.lang.new_node||"New folder")+"</a>")}$li.addClass("leaf");if(this.settings.rules.createat=="top"||b.children("ul").size()==0){this.moved($li,b.children("a:eq(0)"),"inside",true)}else{this.moved($li,b.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",true)}this.select_branch($li.children("a:eq(0)"));if(!c){this.rename()}return $li},rename:function(){if(this.locked){return this.error("LOCKED")}if(this.selected){var c=this;if(!this.check("renameable",this.selected)){return this.error("RENAME: NODE NOT RENAMABLE")}if(!this.settings.callback.beforerename.call(null,this.selected.get(0),c.current_lang,c)){return this.error("RENAME: STOPPED BY USER")}var b=this.selected;if(this.current_lang){b=b.find("a."+this.current_lang).get(0)}else{b=b.find("a:first").get(0)}last_value=b.innerHTML;c.inp=jQuery("<input type='text' />");c.inp.val(last_value).bind("mousedown",function(d){d.stopPropagation()}).bind("mouseup",function(d){d.stopPropagation()}).bind("click",function(d){d.stopPropagation()}).bind("keyup",function(e){var d=e.keyCode||e.which;if(d==27){this.value=last_value;this.blur();return}if(d==13){this.blur();return}});c.inp.blur(function(d){if(this.value==""){this.value==last_value}jQuery(b).html(jQuery(b).parent().find("input").eq(0).attr("value")).get(0).style.display="";jQuery(b).prevAll("span").remove();if(this.value!=last_value){c.settings.callback.onrename.call(null,c.get_node(b).get(0),c.current_lang,c)}c.inp=false});var a=jQuery("<span />").addClass(b.className).append(c.inp);a.attr("style",jQuery(b).attr("style"));b.style.display="none";jQuery(b).parent().prepend(a);c.inp.get(0).focus();c.inp.get(0).select()}else{return this.error("RENAME: NO NODE SELECTED")}},remove:function(c){if(this.locked){return this.error("LOCKED")}if(c){c=this.get_node(c);if(c.size()){if(!this.check("deletable",c)){return this.error("DELETE: NODE NOT DELETABLE")}if(!this.settings.callback.beforedelete.call(null,c.get(0),d)){return this.error("DELETE: STOPPED BY USER")}$parent=c.parent();c=c.remove();$parent.children("li:last").addClass("last");if($parent.children("li").size()==0){$li=$parent.parents("li:eq(0)");$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();this.set_cookie("open")}this.settings.callback.ondelete.call(null,c,this)}}else{if(this.selected){if(!this.check("deletable",this.selected)){return this.error("DELETE: NODE NOT DELETABLE")}if(!this.settings.callback.beforedelete.call(null,this.selected.get(0),d)){return this.error("DELETE: STOPPED BY USER")}$parent=this.selected.parent();var c=this.selected;if(this.settings.rules.multiple==false||this.selected_arr.length==1){var b=true;var a=(this.selected.prev("li:eq(0)").size())?this.selected.prev("li:eq(0)"):this.selected.parents("li:eq(0)")}c=c.remove();$parent.children("li:last").addClass("last");if($parent.children("li").size()==0){$li=$parent.parents("li:eq(0)");$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();this.set_cookie("open")}this.settings.callback.ondelete.call(null,c,this);if(b&&a){this.select_branch(a)}if(this.settings.rules.multiple!=false&&!b){var d=this;this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){d.selected_arr.push(jQuery(this))});if(this.selected_arr.length>0){this.selected=this.selected_arr[0];this.remove()}}}else{return this.error("DELETE: NO NODE SELECTED")}}},get_next:function(a){var b=this.hovered||this.selected;if(b){if(b.hasClass("open")){return a?this.select_branch(b.find("li:eq(0)")):this.hover_branch(b.find("li:eq(0)"))}else{if(jQuery(b).nextAll("li").size()>0){return a?this.select_branch(b.nextAll("li:eq(0)")):this.hover_branch(b.nextAll("li:eq(0)"))}else{return a?this.select_branch(b.parents("li").next("li").eq(0)):this.hover_branch(b.parents("li").next("li").eq(0))}}}},get_prev:function(a){var b=this.hovered||this.selected;if(b){if(b.prev("li").size()){var b=b.prev("li").eq(0);while(b.hasClass("open")){b=b.children("ul:eq(0)").children("li:last")}return a?this.select_branch(b):this.hover_branch(b)}else{return a?this.select_branch(b.parents("li:eq(0)")):this.hover_branch(b.parents("li:eq(0)"))}}},get_left:function(a,c){if(this.settings.ui.rtl&&!c){return this.get_right(a,true)}var b=this.hovered||this.selected;if(b){if(b.hasClass("open")){this.close_branch(b)}else{return a?this.select_branch(b.parents("li:eq(0)")):this.hover_branch(b.parents("li:eq(0)"))}}},get_right:function(a,c){if(this.settings.ui.rtl&&!c){return this.get_left(a,true)}var b=this.hovered||this.selected;if(b){if(b.hasClass("closed")){this.open_branch(b)}else{return a?this.select_branch(b.find("li:eq(0)")):this.hover_branch(b.find("li:eq(0)"))}}},toggleDots:function(){this.container.toggleClass("no_dots")},set_cookie:function(a){if(this.settings.cookies===false){return false}switch(a){case"selected":if(this.settings.rules.multiple!=false&&this.selected_arr.length>1){var c=Array();jQuery.each(this.selected_arr,function(){c.push(this.attr("id"))});c=c.join(",")}else{var c=this.selected?this.selected.attr("id"):false}jQuery.cookie(this.settings.cookies.prefix+"_selected",c,this.settings.cookies.opts);break;case"open":var b="";this.container.find("li.open").each(function(d){b+=this.id+","});jQuery.cookie(this.settings.cookies.prefix+"_open",b.replace(/,$/ig,""),this.settings.cookies.opts);break}},moved:function(l,f,m,a,n){var l=jQuery(l);var b=jQuery(l).parents("ul:eq(0)");var c=jQuery(f);if(l.size()>1){var g=this;var e=this.moved(l.eq(0),f,m,false,n);l.each(function(o){if(o==0){return}e=g.moved(this,e.children("a:eq(0)"),"after",false,n)});return}if(n){l=l.clone();l.each(function(o){this.id=this.id+"_copy";jQuery(this).find("li").each(function(){this.id=this.id+"_copy"});jQuery(this).find("a.clicked").removeClass("clicked")})}if(a){if(!this.settings.callback.beforecreate.call(null,this.get_node(l).get(0),this.get_node(f).get(0),m,this)){return}}else{if(!this.settings.callback.beforemove.call(null,this.get_node(l).get(0),this.get_node(f).get(0),m,this)){return}}if(!a){var e=jQuery(l).parents(".tree:eq(0)");if(e.get(0)!=this.container.get(0)){e=tree_component.inst[e.attr("id")];if(e.settings.languages.length){var h=[];if(this.settings.languages.length==0){h.push("."+e.current_lang)}else{for(i in this.settings.languages){if(i!="indexOf"&&i!="lastIndexOf"){for(j in e.settings.languages){if(j!="indexOf"&&j!="lastIndexOf"){if(this.settings.languages[i]==e.settings.languages[j]){h.push("."+this.settings.languages[i])}}}}}}if(h.length==0){return this.error("MOVE: NO COMMON LANGUAGES")}l.find("a").removeClass("clicked").not(h.join(",")).remove()}}}switch(m){case"before":c.parents("ul:eq(0)").children("li.last").removeClass("last");c.parent().before(l.removeClass("last"));c.parents("ul:eq(0)").children("li:last").addClass("last");break;case"after":c.parents("ul:eq(0)").children("li.last").removeClass("last");c.parent().after(l.removeClass("last"));c.parents("ul:eq(0)").children("li:last").addClass("last");break;case"inside":if(this.settings.data.async){var d=this.get_node(c);if(d.hasClass("closed")){var g=this;return this.open_branch(d,true,function(){g.moved.apply(g,[l,f,m,a,n])})}}if(c.parent().children("ul:first").size()){if(this.settings.rules.createat=="top"){c.parent().children("ul:first").prepend(l.removeClass("last")).children("li:last").addClass("last")}else{c.parent().children("ul:first").children(".last").removeClass("last").end().append(l.removeClass("last")).children("li:last").addClass("last")}}else{l.addClass("last");c.parent().append("<ul/>").removeClass("leaf").addClass("closed");c.parent().children("ul:first").prepend(l)}if(!this.settings.data.async){this.open_branch(c)}break;default:break}if(b.find("li").size()==0){var k=b.parent();k.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();k.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last");this.set_cookie("open")}else{b.children("li.last").removeClass("last");b.children("li:last").addClass("last")}if(a&&m!="inside"){f=this.get_node(f).parents("li:eq(0)")}if(n){this.settings.callback.oncopy.call(null,this.get_node(l).get(0),this.get_node(f).get(0),m,this)}else{if(a){this.settings.callback.oncreate.call(null,this.get_node(l).get(0),this.get_node(f).get(0),this.settings.insertAt,this)}else{this.settings.callback.onmove.call(null,this.get_node(l).get(0),this.get_node(f).get(0),m,this)}}return l},error:function(a){this.settings.callback.error.call(null,a,this);return false},lock:function(a){this.locked=a;if(this.locked){this.container.addClass("locked")}else{this.container.removeClass("locked")}},cut:function(){if(this.locked){return this.error("LOCKED")}if(!this.selected){return this.error("CUT: NO NODE SELECTED")}this.copy_nodes=false;this.cut_nodes=this.container.find("a.clicked").filter(":first-child").parent()},copy:function(){if(this.locked){return this.error("LOCKED")}if(!this.selected){return this.error("COPY: NO NODE SELECTED")}this.copy_nodes=this.container.find("a.clicked").filter(":first-child").parent();this.cut_nodes=false},paste:function(){if(this.locked){return this.error("LOCKED")}if(!this.selected){return this.error("PASTE: NO NODE SELECTED")}if(!this.copy_nodes&&!this.cut_nodes){return this.error("PASTE: NOTHING TO DO")}if(this.copy_nodes&&this.copy_nodes.size()){if(!this.checkMove(this.copy_nodes,this.selected.children("a:eq(0)"),"inside")){return false}this.moved(this.copy_nodes,this.selected.children("a:eq(0)"),"inside",false,true);this.copy_nodes=false}if(this.cut_nodes&&this.cut_nodes.size()){if(!this.checkMove(this.cut_nodes,this.selected.children("a:eq(0)"),"inside")){return false}this.moved(this.cut_nodes,this.selected.children("a:eq(0)"),"inside");this.cut_nodes=false}},search:function(e){var g=this;if(!e||(this.srch&&e!=this.srch)){this.srch="";this.srch_opn=false;this.container.find("a.search").removeClass("search")}this.srch=e;if(!e){return}if(this.settings.data.async){if(!this.srch_opn){var b=jQuery.extend({search:e},this.settings.data.async_data(false));jQuery.ajax({type:this.settings.data.method,url:this.settings.data.url,data:b,dataType:"text",success:function(h){g.srch_opn=jQuery.unique(h.split(","));g.search.apply(g,[e])}})}else{if(this.srch_opn.length){if(this.srch_opn&&this.srch_opn.length){var f=false;for(var c=0;c<this.srch_opn.length;c++){if(this.get_node("#"+this.srch_opn[c]).size()>0){f=true;var d="#"+this.srch_opn[c];delete this.srch_opn[c];this.open_branch(d,true,function(){g.search.apply(g,[e])})}}if(!f){this.srch_opn=[];g.search.apply(g,[e])}}}else{var a="a";if(this.settings.languages.length){a+="."+this.current_lang}this.container.find(a+":contains('"+e+"')").addClass("search");this.srch_opn=false}}}else{var a="a";if(this.settings.languages.length){a+="."+this.current_lang}this.container.find(a+":contains('"+e+"')").addClass("search").parents("li.closed").each(function(){g.open_branch(this,true)})}},destroy:function(){try{var a=["click","dblclick","contextmenu","mouseover","mousedown"];for(i in a){if(i!="indexOf"&&i!="lastIndexOf"){var b=this.container.indexer(a[i]);b.stop();jQuery.removeData(b.listener,b.event+".indexer")}}}catch(c){}this.container.unbind();this.container.removeClass("tree").children("ul").removeClass("tree-"+this.settings.ui.theme_name).find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked");if(this.cntr==tree_component.focused){for(i in tree_component.inst){if(i!="indexOf"&&i!="lastIndexOf"){if(i!=this.cntr&&i!=this.container.attr("id")){tree_component.inst[i].focus();break}}}}delete tree_component.inst[this.cntr];delete tree_component.inst[this.container.attr("id")];tree_component.cntr--}}};