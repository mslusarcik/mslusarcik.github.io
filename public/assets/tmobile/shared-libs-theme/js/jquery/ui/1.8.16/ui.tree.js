(function(a){a.widget("ui.tree",{init:function(){var b=this;this.identifier=(new Date()).getTime()+Math.random();this.element.sortable({items:this.options.sortOn,scope:this.identifier,distance:this.options.distance,placeholder:"ui-tree-placeholder",helper:this.options.helper,handle:this.options.handle,scroll:this.options.scroll,appendTo:this.options.appendTo,start:function(f,d){var c=a(this).data("sortable");c.placeholder.hide();c.helperProportions.height=c.currentItem.find(b.options.dropOn).length?c.currentItem.find(b.options.dropOn).outerHeight():c.currentItem.outerHeight();c._preserveHelperProportions=true;c.refreshPositions(true);b.originalParent=d.item.parent();(b.options.start&&b.options.start.apply(this,[f,d]))},stop:function(d,c){var f=a(this).data("sortable");a(f.options.items,f.element).removeClass(b.options.sortIndicatorDown).removeClass(b.options.sortIndicatorUp);if(b.originalParent.is(":empty")){b.originalParent.remove()}(b.options.stop&&b.options.stop.apply(this,[d,c]))},sortIndicator:function(g,f,c,d){c?c[0].appendChild(this.placeholder[0]):f.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=="down"?f.item[0]:f.item[0].nextSibling));a(this.options.items,this.element).removeClass(b.options.sortIndicatorDown).removeClass(b.options.sortIndicatorUp);f.item.addClass(this.direction=="down"?b.options.sortIndicatorDown:b.options.sortIndicatorUp)}});a(this.options.dropOn,this.element).droppable({accept:this.options.sortOn,hoverClass:this.options.dropHoverClass,tolerance:"pointer",scope:this.identifier,over:function(d,c){a(b.options.sortOn,b.element).removeClass(b.options.sortIndicatorDown).removeClass(b.options.sortIndicatorUp);b.overDroppable=true;b.trigger("over",d,c)},out:function(d,c){b.overDroppable=false;(b.options.out&&b.options.out.apply(this,[d,c]))},drop:function(f,d){var c=a(this).parent().find("ul");if(!c.length){var c=a("<ul></ul>").appendTo(a(this).parent())}d.draggable.appendTo(a(this).parent().find("> ul"));b.element.data("sortable")._noFinalSort=true;(b.options.drop&&b.options.drop.apply(this,[f,d]))}})}});a.extend(a.ui.tree,{defaults:{sortOn:"*",dropOn:"div",dropHoverClass:"ui-tree-hover",sortIndicatorDown:"hover-down",sortIndicatorUp:"hover-up"}})})(jQuery);